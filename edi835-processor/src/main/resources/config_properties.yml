# ============================================================================
# EDI 835 Processor - Configuration Properties Reference
# ============================================================================
# This file documents all available configuration properties for the
# ChangeFeedConfig, RestClientConfig, and SchedulerConfig components.

# ============================================================================
# Cosmos DB Change Feed Configuration
# ============================================================================
cosmos:
  changefeed:
    # Container name to monitor for changes (required)
    container: claims
    
    # Container name for lease management (required)
    lease-container: leases
    
    # Unique identifier for this processor instance
    # Use ${HOSTNAME} or unique identifier per instance in distributed setup
    host-name: ${HOSTNAME:edi835-processor-1}
    
    # Maximum number of items to process in each batch
    # Range: 1-1000, Default: 100
    # Higher values = better throughput but more memory
    max-items-count: 100
    
    # Polling interval in milliseconds
    # Range: 100-60000, Default: 5000
    # Lower values = lower latency but more RU consumption
    poll-interval-ms: 5000
    
    # Whether to start processing from the beginning of the change feed
    # Set to true for initial load, false for production (continues from checkpoint)
    start-from-beginning: false

# ============================================================================
# REST Client Configuration
# ============================================================================
rest:
  client:
    # Connection timeout in milliseconds
    # Time to wait for connection establishment
    # Default: 5000 (5 seconds)
    connect-timeout-ms: 5000
    
    # Read timeout in milliseconds
    # Time to wait for response after connection established
    # Default: 30000 (30 seconds)
    read-timeout-ms: 30000
    
    # Maximum number of concurrent connections
    # Adjust based on external service capacity
    # Default: 50
    max-connections: 50

# ============================================================================
# Scheduler Configuration
# ============================================================================
scheduler:
  # Thread pool size for scheduled tasks
  # Should be >= number of @Scheduled methods running concurrently
  # Default: 5
  pool-size: 5
  
  # Prefix for scheduler thread names (for debugging/monitoring)
  # Default: edi835-scheduler-
  thread-name-prefix: edi835-scheduler-
  
  # Seconds to wait for tasks to complete during shutdown
  # Default: 60
  await-termination-seconds: 60
  
  # Whether to wait for running tasks to complete before shutdown
  # true = graceful shutdown, false = immediate termination
  # Default: true
  wait-for-tasks-to-complete: true

# ============================================================================
# Environment-Specific Configurations
# ============================================================================

---
# Development Profile
spring:
  config:
    activate:
      on-profile: dev

cosmos:
  changefeed:
    poll-interval-ms: 10000  # Slower polling in dev
    start-from-beginning: true  # Process all history in dev

rest:
  client:
    connect-timeout-ms: 10000  # More lenient timeouts in dev
    read-timeout-ms: 60000

scheduler:
  pool-size: 2  # Smaller pool in dev

logging:
  level:
    com.healthcare.edi835.config: DEBUG
    com.healthcare.edi835.changefeed: DEBUG

---
# Production Profile
spring:
  config:
    activate:
      on-profile: prod

cosmos:
  changefeed:
    poll-interval-ms: 5000
    start-from-beginning: false
    max-items-count: 200  # Higher batch size for production

rest:
  client:
    connect-timeout-ms: 5000
    read-timeout-ms: 30000
    max-connections: 100  # More connections for production load

scheduler:
  pool-size: 10  # Larger pool for production

logging:
  level:
    com.healthcare.edi835.config: INFO
    com.healthcare.edi835.changefeed: INFO

---
# Testing Profile
spring:
  config:
    activate:
      on-profile: test

cosmos:
  changefeed:
    poll-interval-ms: 1000
    max-items-count: 10

rest:
  client:
    connect-timeout-ms: 1000
    read-timeout-ms: 5000

scheduler:
  pool-size: 1

# ============================================================================
# Performance Tuning Guidelines
# ============================================================================

# Change Feed Performance:
# - Increase max-items-count for higher throughput (more RU cost)
# - Decrease poll-interval-ms for lower latency (more RU cost)
# - Scale horizontally by running multiple instances (unique host-name per instance)
# - Monitor RU consumption and adjust accordingly

# REST Client Performance:
# - Increase max-connections if seeing connection pool exhaustion
# - Adjust timeouts based on external service SLAs
# - Monitor response times and adjust accordingly

# Scheduler Performance:
# - Increase pool-size if tasks are being rejected
# - Monitor thread pool metrics via actuator endpoints
# - Consider increasing await-termination-seconds for long-running tasks

# ============================================================================
# Monitoring Configuration
# ============================================================================

management:
  endpoints:
    web:
      exposure:
        include:
          - health
          - metrics
          - scheduledtasks  # View all scheduled tasks
          - threaddump      # Debug thread pool issues
  
  metrics:
    tags:
      application: ${spring.application.name}
      environment: ${spring.profiles.active}
    
  health:
    cosmos:
      enabled: true
    diskspace:
      enabled: true

# ============================================================================
# Troubleshooting
# ============================================================================

# Issue: High Cosmos DB RU consumption
# Solution: Increase poll-interval-ms, decrease max-items-count

# Issue: Scheduled tasks being rejected
# Solution: Increase scheduler.pool-size

# Issue: REST client timeouts
# Solution: Increase rest.client.read-timeout-ms, check external service health

# Issue: Change feed processing lag
# Solution: Increase max-items-count, scale horizontally with more instances

# Issue: Memory pressure
# Solution: Decrease max-items-count, adjust JVM heap settings
